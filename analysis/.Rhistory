}
databases <- lapply(databases, replace_col_names)
}
prefix_vec = c("k__", "p__", "c__", "o__", "f__", "g__", "s__")
# Kingdom level
if (level == 1) {
kingdoms <- vector("list", length(databases))
for (i in 1:length(databases)) {
kingdoms[[i]] <- databases[[i]][grepl(paste0(prefix_vec[1], collapse = "|"), databases[[i]]$Taxa) & !grepl(paste0(prefix_vec[-1], collapse = "|"), databases[[i]]$Taxa),]
kingdoms[[i]] <- kingdoms[[i]][str_count(kingdoms[[i]]$Taxa, "k__") == 1, ]
kingdoms[[i]][nrow(kingdoms[[i]]) + 1,] <- c(0, 100 - colSums(kingdoms[[i]][,-c(which(colnames(kingdoms[[i]])=="Taxa"), which(colnames(kingdoms[[i]])=="TaxIDs"))]), 0)
kingdoms[[i]][nrow(kingdoms[[i]]),c(which(colnames(kingdoms[[i]])=="Taxa"), which(colnames(kingdoms[[i]])=="TaxIDs"))] <- "UNCLASSIFIED"
kingdoms[[i]]$Taxa <- NULL
kingdoms[[i]] <- kingdoms[[i]][, c("TaxIDs", colnames(kingdoms[[i]])[colnames(kingdoms[[i]])!="TaxIDs"] )]
}
saveRDS(kingdoms, paste0("scripts/cache/", dataset, level, ".rds"))
return (kingdoms)
}
if (level %in% 2:6) {
taxa <- vector("list", length(databases))
for (i in 1:length(databases)) {
taxa[[i]] <- databases[[i]][grepl(paste0(prefix_vec[level], collapse = "|"), databases[[i]]$Taxa) & !grepl(paste0(prefix_vec[-(1:level)], collapse = "|"), databases[[i]]$Taxa),]
taxa[[i]]$TaxIDs <- str_split(taxa[[i]]$TaxIDs, "\\|") %>% mapply(FUN = "[[", as.list(str_count(taxa[[i]]$TaxIDs, "\\|") + 1))
taxa[[i]][nrow(taxa[[i]]) + 1,] <- c(0, 100 - colSums(taxa[[i]][,-c(which(colnames(taxa[[i]])=="Taxa"), which(colnames(taxa[[i]])=="TaxIDs"))]), 0)
taxa[[i]][nrow(taxa[[i]]),c(which(colnames(taxa[[i]])=="Taxa"), which(colnames(taxa[[i]])=="TaxIDs"))] <- "UNCLASSIFIED"
taxa[[i]]$Taxa <- NULL
taxa[[i]] <- taxa[[i]][, c("TaxIDs", colnames(taxa[[i]])[colnames(taxa[[i]])!="TaxIDs"] )]
}
saveRDS(taxa, paste0("scripts/cache/", dataset, level, ".rds"))
return (taxa)
}
if (level == 7) {
taxa <- vector("list", length(databases))
for (i in 1:length(databases)) {
taxa[[i]] <- databases[[i]][grepl(paste0(prefix_vec[level], collapse = "|"), databases[[i]]$Taxa),]
taxa[[i]]$TaxIDs <- str_split(taxa[[i]]$TaxIDs, "\\|") %>% mapply(FUN = "[[", as.list(str_count(taxa[[i]]$TaxIDs, "\\|") + 1))
taxa[[i]][nrow(taxa[[i]]) + 1,] <- c(0, 100 - colSums(taxa[[i]][,-c(which(colnames(taxa[[i]])=="Taxa"), which(colnames(taxa[[i]])=="TaxIDs"))]), 0)
taxa[[i]][nrow(taxa[[i]]),c(which(colnames(taxa[[i]])=="Taxa"), which(colnames(taxa[[i]])=="TaxIDs"))] <- "UNCLASSIFIED"
taxa[[i]]$Taxa <- NULL
taxa[[i]] <- taxa[[i]][, c("TaxIDs", colnames(taxa[[i]])[colnames(taxa[[i]])!="TaxIDs"] )]
}
saveRDS(taxa, paste0("scripts/cache/", dataset, level, ".rds"))
return (taxa)
}
}
preprocess_all_real <- function() {
for (dataset in list.files("real_data_outputs/inputs")) {
for (level in 1:7) {
print(paste0("Processing ", dataset, " at level ", level))
preprocess(dataset, level)
}
}
}
preprocess_all_simulated <- function() {
for (dataset in list.files("simulation_outputs/inputs")) {
for (level in 1:7) {
print(paste0("Processing ", dataset, " at level ", level))
preprocess(dataset, level, FALSE)
}
}
}
remove_non_ncbi <- function(taxa) {
for (i in 1:length(taxa)) {
tmp <- taxa[[i]]
tmp <- tmp[!is.na(as.numeric(tmp$TaxID)),]
taxa[[i]] <- tmp
}
return(taxa)
}
preprocess_all_real()
preprocess_all_simulated()
list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles")
}
list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
getwd()
dataset
dataset <- "gut"
list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles", in_files)
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles", in_files)
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
in_files
in_files[1]
read.csv(in_files[1], sep='\t')
read.csv(in_files[1], sep='\t', skip = 4)
file = in_files[1]
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile)
str_split(file)
str_split(file, "/")
str_split(file, "/")[[1]][6]
str_split(file, "/", 6)
str_split(file, "/")[[1]][6] %>% str_split(".")
str_split(file, "/")[[1]][6] %>% str_split("\\.")
str_split(file, "/")[[1]][6] %>% str_split("\\.")[[1]]
(str_split(file, "/")[[1]][6] %>% str_split("\\."))[[1]]
(str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]]
(str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1]
colnames(profile) <- c("TaxID", "rank", "taxpath", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile$rank
profile[profile$rank != "strain",]
profile <- profile[profile$rank != "strain",]
profile$CAMI_OTU
profile$CAMI_genome
profile
read.csv('databases/ncbi_taxdump/unknown_taxa.tsv')
read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
profile$single_id
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$single_id
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile$TaxID
profile$single_id
unknown_taxa
unknown_taxa[1]
profile$single_id[1]
file
file <- in_files[50]
file
file <- in_files[50]
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile$TaxID
profile
profile[c(3, 4, 5)]
profile <- profile[c(3, 5)]
profile
full_profile = data.frame("TaxID")
full_profile
full_profile = data.frame("TaxID"=NULL)
full_profile
full_profile = data.frame("TaxID"=c())
full_profile
colnames(profule)
colnames(full_profile)
full_profile = data.frame(matrix(nrow = 0, ncol = 0))
full_profile
full_profile = data.frame(matrix(nrow = 0, ncol = 1))
full_profile
colnames(full_profile) <- c("TaxID")
full_profile
full_join(full_profile, profile)
full_profile <- data.frame("TaxID" = "2")
full_profile
full_join(full_profile, profile)
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile)
}
full_profile
full_profile$TaxID
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile <- profile[c(3, 5)]
full_profile <- merge(full_profile, profile, by='TaxID')
}
full_profile
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
file = in_files[1]
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile <- profile[c(3, 5)]
full_profile <- merge(full_profile, profile, by='TaxID')
file = in_files[2]
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile <- profile[c(3, 5)]
full_profile
file = in_files[1]
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
full_profile
file <- in_files[2]
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile$TaxID[profile$single_id %in% unknown_taxa] <- "UNCLASSIFIED"
profile <- profile[c(3, 5)]
full_profile
profile
profile[profile$TaxID=="UNCLASSIFIED",2]
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile
full_profile[is.na(full_profile)] <- 0
full_profile
level <- 1
full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID
full_profile <- full_profile[grepl("^2759",full_profile$TaxID),]
full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile
level <0 2
level <0- 2
level <- 2
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile$TaxID
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile$TaxID
level <- 7
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile$TaxID
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile$TaxID[full_profile$TaxID %in% unknown_taxa] <- "UNCLASSIFIED"
full_profile$TaxID
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile
colSums(full_profile[,-1])
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile[nrow(full_profile) + 1,] <- c(0, colSums(full_profile[,-1]))
cbind(full_profile$TaxID, full_profile$profile.n.300.size.7.5.k.100.sigma.1.0.up.1.0.mut_rate.0.0_sample_3)
cbind(full_profile$TaxID, full_profile$profile.n.300.size.7.5.k.100.sigma.1.0.up.1.0.mut_rate.0.0_sample_2)
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile[nrow(full_profile) + 1,] <- c(0, 100 - colSums(full_profile[,-1]))
cbind(full_profile$TaxID, full_profile$profile.n.300.size.7.5.k.100.sigma.1.0.up.1.0.mut_rate.0.0_sample_2)
full_profile$TaxID[nrow(full_profile)] <- "UNCLASSIFIED"
full_profile
preprocess_simulation_truths(dataset, level) {
preprocess_simulation_truths(dataset, level) {
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile[nrow(full_profile) + 1,] <- c(0, 100 - colSums(full_profile[,-1]))
full_profile$TaxID[nrow(full_profile)] <- "UNCLASSIFIED"
write.csv(full_profile, paste0("simulation_outputs/inputs/", dataset, "/true_profile/", dataset, level, ".tsv"), sep='\t')
write.table(full_profile, paste0("simulation_outputs/inputs/", dataset, "/true_profile/", dataset, level, ".tsv"), sep='\t')
preprocess_simulation_truths(dataset, level) {
preprocess_simulation_truths <- function(dataset, level) {
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile[nrow(full_profile) + 1,] <- c(0, 100 - colSums(full_profile[,-1]))
full_profile$TaxID[nrow(full_profile)] <- "UNCLASSIFIED"
write.table(full_profile, paste0("simulation_outputs/inputs/", dataset, "/true_profile/", dataset, level, ".tsv"), sep='\t')
}
preprocess_all_simulated <- function() {
for (dataset in list.files("simulation_outputs/inputs")) {
for (level in 1:7) {
print(paste0("Processing ", dataset, " at level ", level))
preprocess_simulation_truths(dataset, level)
}
}
}
preprocess_all_truths <- function() {
for (dataset in list.files("simulation_outputs/inputs")) {
for (level in 1:7) {
print(paste0("Processing ", dataset, " at level ", level))
preprocess_simulation_truths(dataset, level)
}
}
}
preprocess_all_truths()
full_profile
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile
full_profile[nrow(full_profile) + 1,] <- c(0, 100 - colSums(full_profile[,-1]))
full_profile$TaxID[nrow(full_profile)] <- "UNCLASSIFIED"
full_profile
full_profile$TaxID
full_profile$profile.n.150.size.7.5.k.100.sigma.1.0.up.0.5.mut_rate.0.0_sample_0
level <0- 2
level <- 2
in_files = list.files(paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles"))
in_files = paste0("simulation_outputs/inputs/", dataset, "/true_profile/profiles/", in_files)
unknown_taxa = read.csv('databases/ncbi_taxdump/unknown_taxa.tsv', header = F)[,1]
full_profile <- data.frame("TaxID" = "2")
for (file in in_files) {
profile = read.csv(file, sep='\t', skip = 4)
colnames(profile) <- c("single_id", "rank", "TaxID", "Taxa", (str_split(file, "/")[[1]][6] %>% str_split("\\.(?!.*\\.)"))[[1]][1], "CAMI_genome", "CAMI_OTU")
profile <- profile[profile$rank != "strain",]
profile <- profile[c(3, 5)]
full_profile <- full_join(full_profile, profile, by='TaxID')
}
full_profile[is.na(full_profile)] <- 0
# No Eukaryotes
full_profile <- full_profile[!grepl("^2759",full_profile$TaxID),]
full_profile <- full_profile[str_count(full_profile$TaxID, "\\|") == level - 1,]
full_profile$TaxID <- gsub(".*\\|","",full_profile$TaxID)
full_profile <- full_profile[!(full_profile$TaxID %in% unknown_taxa),]
full_profile[nrow(full_profile) + 1,] <- c(0, 100 - colSums(full_profile[,-1]))
full_profile$TaxID[nrow(full_profile)] <- "UNCLASSIFIED"
full_profile
full_profile$TaxID
full_profile$profile.n.150.size.7.5.k.100.sigma.1.0.up.0.5.mut_rate.0.0_sample_0
write.table(full_profile, paste0("simulation_outputs/inputs/", dataset, "/true_profile/", dataset, level, ".tsv"), sep='\t')
head(full_profile)
write.table(full_profile, paste0("simulation_outputs/inputs/", dataset, "/true_profile/", dataset, level, ".tsv"), sep='\t', row.names = F)
preprocess_all_truths <- function() {
for (dataset in list.files("simulation_outputs/inputs")) {
for (level in 1:7) {
print(paste0("Processing ", dataset, " at level ", level))
preprocess_simulation_truths(dataset, level)
}
}
}
preprocess_all_truths()
preprocess_all_truths()
file.exists(paste0("simulation_outputs/inputs/", dataset, "/true_profile/", dataset, level, ".tsv"))
